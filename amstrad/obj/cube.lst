ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 .include "main.h.s"
                              1 .globl cpct_disableFirmware_asm
                              2 .globl cpct_drawSolidBox_asm
                              3 .globl cpct_getScreenPtr_asm
                              4 .globl cpct_waitVSYNC_asm
                              5 .globl cpct_setVideoMode_asm
                              6 .globl cpct_scanKeyboard_asm
                              7 .globl cpct_isKeyPressed_asm
                              8 .globl cpct_setVideoMemoryPage_asm
                              9 .globl _cpct_memset_f64_asm
                             10 .globl cpct_drawSprite_asm
                             11 .globl cpct_setPalette_asm
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              2 .include "cube.h.s"
                              1 
                              2 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                              3 ;;MACROS
                              4 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                              5 .macro DefineCubeLine1 _name, _x, _y, _w, _h, _col, _hp
                              6 _name:
                              7     DefineDrawableEntity _name'_dw, _x, _y, _w, _h, _col
                              8     .db     _hp     ;; Hitpoints
                              9 .endm
                     0000    10 c_de        = 0
                     0006    11 c_de_size   = 6
                     0006    12 c_hp        = 0 + c_de_size
                             13 ;;.macro DefineCubeLine1Default _name, _suf
                             14 ;;    DefineCubeLine1 _name'_suf, 0, 0, 0, 0, 0xFF, 0
                             15 ;;.endm
                             16 ;;.macro DefineNCubeLine1 _name, _n
                             17 
                             18 ;;    _s = 0
                             19 ;;    .rept _n
                             20 ;;        DefineCubeLine1Default _name, \_s
                             21 
                             22 ;;        _s = _s + 1
                             23 ;;    .endm
                             24 ;;.endm
                             25 
                             26 
                             27 
                             28 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             29 ;;OBJECTS CREATED WITH MACROS
                             30 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             31 .globl cube_clear
                             32 .globl cube_draw
                             33 .globl cube_drawAll
                             34 .globl cube_clearAll
                             35 
                             36 .globl cube_reset
                             37 
                             38 .globl destroy_cube
                             39 
                             40 .globl k_max_cube_line	
                             41 
                             42 .globl cubeline10
                             43 .globl cubeline11
                             44 .globl cubeline12
                             45 .globl cubeline13
                             46 .globl cubeline14
                             47 .globl cubeline15
                             48 .globl cubeline16
                             49 .globl cubeline17
                             50 .globl cubeline18
                             51 .globl cubeline19
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                              3 .include "render.h.s"
                              1 
                              2 
                              3 ;;Drawable Entity
                              4 .macro DefineDrawableEntity _name, _x, _y, _w, _h, _sprite
                              5 _name:
                              6     .db _x, _y
                              7     .db _w, _h
                              8     .dw _sprite
                              9 
                             10 _name'_size = . - _name
                             11 .endm
                     0001    12 dc_x    = 0     dc_y    = 1
                     0003    13 dc_w    = 2     dc_h    = 3
                     0005    14 dc_sp_l  = 4    dc_sp_h  = 5
                             15 
                             16 .globl ren_clearBackBuffers
                             17 ;;.globl ren_switchBuffers
                             18 .globl render_drawCube
                             19 .globl ren_newScene
                             20 .globl m_back_buffer
                             21 .globl m_front_buffer
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



                              4 .include "ball.h.s"
                              1 
                              2 
                              3 
                              4 .globl ball_clear
                              5 .globl ball_draw
                              6 .globl ball_update
                              7 .globl ball_move
                              8 .globl ball_reset
                              9 
                             10 
                             11 
                             12 
                             13 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,
                             14 ;;
                             15 ;;MACROS
                             16 ;;
                             17 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             18 
                             19    .macro DefineBall _name, _x, _y, _w, _h, _sprite,  _vx, _vy,_upd,_hp
                             20 _name: 
                             21 	DefineDrawableEntity _name'_dw, _x, _y, _w, _h, _sprite
                             22   ; .db    _x, _y     ;; X, Y
                             23    ;.db    _w, _h     ;; W, H
                             24     ;.db   _col        ;; Color
                             25    .db   _vx, _vy    ;; VX, VY
                             26    .dw   _upd        ;; Update 
                             27    .db _hp
                             28 .endm
                             29 ;bl_x = 0
                             30 ;bl_y = 1
                             31 ;bl_w = 2
                             32 ;bl_h = 3
                             33 ;bl_col = 4
                     0006    34 bl_vx = 6
                     0007    35 bl_vy = 7
                     0008    36 bl_up_l = 8
                     0009    37 bl_up_h = 9
                     000A    38 bl_hp = 10
                             39 	
                             40 
                             41 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             42 ;;
                             43 ;;OBJETOS CREADOS CON LA MACROS
                             44 ;;
                             45 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             46 
                             47 .globl ball
                             48 .globl balldefault
                             49 ;.globl screenPointer
                             50 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



                              5 
                              6 .globl _cubeline_sp
                              7 
                              8 
                     000A     9 k_max_cube_line = 10
                     0007    10 k_cube_size = 7
                             11 
                             12 
   0000                      13 DefineCubeLine1 cubedefault, 0x00, 0x10, 0x04, 0x08, _cubeline_sp, 0x01
   0000                       1 cubedefault:
   0000                       2     DefineDrawableEntity cubedefault_dw, 0x00, 0x10, 0x04, 0x08, _cubeline_sp
   0000                       1 cubedefault_dw:
   0000 00 10                 2     .db 0x00, 0x10
   0002 04 08                 3     .db 0x04, 0x08
   0004 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubedefault_dw_size = . - cubedefault_dw
   0006 01                    3     .db     0x01     ;; Hitpoints
                             14 
                             15 
   0007                      16 DefineCubeLine1 cubeline10, 0x00, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   0007                       1 cubeline10:
   0007                       2     DefineDrawableEntity cubeline10_dw, 0x00, 0x10, 0x08, 0x08, _cubeline_sp
   0007                       1 cubeline10_dw:
   0007 00 10                 2     .db 0x00, 0x10
   0009 08 08                 3     .db 0x08, 0x08
   000B 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline10_dw_size = . - cubeline10_dw
   000D 01                    3     .db     0x01     ;; Hitpoints
   000E                      17 DefineCubeLine1 cubeline11, 0x08, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   000E                       1 cubeline11:
   000E                       2     DefineDrawableEntity cubeline11_dw, 0x08, 0x10, 0x08, 0x08, _cubeline_sp
   000E                       1 cubeline11_dw:
   000E 08 10                 2     .db 0x08, 0x10
   0010 08 08                 3     .db 0x08, 0x08
   0012 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline11_dw_size = . - cubeline11_dw
   0014 01                    3     .db     0x01     ;; Hitpoints
   0015                      18 DefineCubeLine1 cubeline12, 0x10, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   0015                       1 cubeline12:
   0015                       2     DefineDrawableEntity cubeline12_dw, 0x10, 0x10, 0x08, 0x08, _cubeline_sp
   0015                       1 cubeline12_dw:
   0015 10 10                 2     .db 0x10, 0x10
   0017 08 08                 3     .db 0x08, 0x08
   0019 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline12_dw_size = . - cubeline12_dw
   001B 01                    3     .db     0x01     ;; Hitpoints
   001C                      19 DefineCubeLine1 cubeline13, 0x18, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   001C                       1 cubeline13:
   001C                       2     DefineDrawableEntity cubeline13_dw, 0x18, 0x10, 0x08, 0x08, _cubeline_sp
   001C                       1 cubeline13_dw:
   001C 18 10                 2     .db 0x18, 0x10
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 6.
Hexadecimal [16-Bits]



   001E 08 08                 3     .db 0x08, 0x08
   0020 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline13_dw_size = . - cubeline13_dw
   0022 01                    3     .db     0x01     ;; Hitpoints
   0023                      20 DefineCubeLine1 cubeline14, 0x20, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   0023                       1 cubeline14:
   0023                       2     DefineDrawableEntity cubeline14_dw, 0x20, 0x10, 0x08, 0x08, _cubeline_sp
   0023                       1 cubeline14_dw:
   0023 20 10                 2     .db 0x20, 0x10
   0025 08 08                 3     .db 0x08, 0x08
   0027 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline14_dw_size = . - cubeline14_dw
   0029 01                    3     .db     0x01     ;; Hitpoints
   002A                      21 DefineCubeLine1 cubeline15, 0x28, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   002A                       1 cubeline15:
   002A                       2     DefineDrawableEntity cubeline15_dw, 0x28, 0x10, 0x08, 0x08, _cubeline_sp
   002A                       1 cubeline15_dw:
   002A 28 10                 2     .db 0x28, 0x10
   002C 08 08                 3     .db 0x08, 0x08
   002E 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline15_dw_size = . - cubeline15_dw
   0030 01                    3     .db     0x01     ;; Hitpoints
   0031                      22 DefineCubeLine1 cubeline16, 0x30, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   0031                       1 cubeline16:
   0031                       2     DefineDrawableEntity cubeline16_dw, 0x30, 0x10, 0x08, 0x08, _cubeline_sp
   0031                       1 cubeline16_dw:
   0031 30 10                 2     .db 0x30, 0x10
   0033 08 08                 3     .db 0x08, 0x08
   0035 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline16_dw_size = . - cubeline16_dw
   0037 01                    3     .db     0x01     ;; Hitpoints
   0038                      23 DefineCubeLine1 cubeline17, 0x38, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   0038                       1 cubeline17:
   0038                       2     DefineDrawableEntity cubeline17_dw, 0x38, 0x10, 0x08, 0x08, _cubeline_sp
   0038                       1 cubeline17_dw:
   0038 38 10                 2     .db 0x38, 0x10
   003A 08 08                 3     .db 0x08, 0x08
   003C 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline17_dw_size = . - cubeline17_dw
   003E 01                    3     .db     0x01     ;; Hitpoints
   003F                      24 DefineCubeLine1 cubeline18, 0x40, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   003F                       1 cubeline18:
   003F                       2     DefineDrawableEntity cubeline18_dw, 0x40, 0x10, 0x08, 0x08, _cubeline_sp
   003F                       1 cubeline18_dw:
   003F 40 10                 2     .db 0x40, 0x10
   0041 08 08                 3     .db 0x08, 0x08
   0043 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline18_dw_size = . - cubeline18_dw
   0045 01                    3     .db     0x01     ;; Hitpoints
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 7.
Hexadecimal [16-Bits]



   0046                      25 DefineCubeLine1 cubeline19, 0x48, 0x10, 0x08, 0x08,_cubeline_sp, 0x01
   0046                       1 cubeline19:
   0046                       2     DefineDrawableEntity cubeline19_dw, 0x48, 0x10, 0x08, 0x08, _cubeline_sp
   0046                       1 cubeline19_dw:
   0046 48 10                 2     .db 0x48, 0x10
   0048 08 08                 3     .db 0x08, 0x08
   004A 00 00                 4     .dw _cubeline_sp
                              5 
                     0006     6 cubeline19_dw_size = . - cubeline19_dw
   004C 01                    3     .db     0x01     ;; Hitpoints
                             26 
                             27 
   004D 02                   28 m_num_cube: .db 2
                             29 
                             30 
   004E                      31 cube_clear:
   004E DD 21 07 00   [14]   32 ld ix,#cubeline10
   0052 CD B6 00      [17]   33 call cube_clearAll
   0055 DD 21 0E 00   [14]   34 ld ix,#cubeline11
   0059 CD B6 00      [17]   35 call cube_clearAll
   005C DD 21 15 00   [14]   36 ld ix,#cubeline12
   0060 CD B6 00      [17]   37 call cube_clearAll
   0063 DD 21 1C 00   [14]   38 ld ix,#cubeline13
   0067 CD B6 00      [17]   39 call cube_clearAll
   006A DD 21 23 00   [14]   40 ld ix,#cubeline14
   006E CD B6 00      [17]   41 call cube_clearAll
   0071 DD 21 2A 00   [14]   42 ld ix,#cubeline15
   0075 CD B6 00      [17]   43 call cube_clearAll
   0078 DD 21 31 00   [14]   44 ld ix,#cubeline16
   007C CD B6 00      [17]   45 call cube_clearAll
   007F DD 21 38 00   [14]   46 ld ix,#cubeline17
   0083 CD B6 00      [17]   47 call cube_clearAll
   0086 DD 21 3F 00   [14]   48 ld ix,#cubeline18
   008A CD B6 00      [17]   49 call cube_clearAll
   008D DD 21 46 00   [14]   50 ld ix,#cubeline19
   0091 CD B6 00      [17]   51 call cube_clearAll
   0094 C9            [10]   52 ret
                             53 
   0095                      54 cube_draw:
   0095 DD 21 07 00   [14]   55 ld ix,#cubeline10
   0099 3E 0A         [ 7]   56 ld a,#k_max_cube_line
                             57 
   009B                      58 rep:
   009B F5            [11]   59 push af
   009C CD AA 00      [17]   60 call cube_drawAll
                             61 
   009F 11 07 00      [10]   62 ld de,#k_cube_size
   00A2 DD 19         [15]   63 add ix, de
   00A4 F1            [10]   64 pop af
   00A5 3D            [ 4]   65 dec a
                             66 
   00A6 C2 9B 00      [10]   67 jp nz,rep
                             68 
                             69 
   00A9 C9            [10]   70 ret
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 8.
Hexadecimal [16-Bits]



                             71 
                             72 
                             73 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             74 ;; DRAW ENTITY
                             75 ;; REGISTERS DETROYED: AF, BC, DE ,HL
                             76 ;; INPUT: IX -> Points to entity
                             77 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   00AA                      78 cube_drawAll:
                             79 
   00AA DD 7E 06      [19]   80 	ld a,c_hp(ix)
   00AD D6 01         [ 7]   81 	sub #1
                             82 
   00AF C2 B5 00      [10]   83 	jp nz, ommit
                             84 
   00B2 CD 00 00      [17]   85 	call render_drawCube
                             86 	
   00B5                      87 	ommit:
   00B5 C9            [10]   88    	ret
                             89 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             90 ;; BORRA UNA ENTIDAD
                             91 ;; PARA CUADRADOS UNICAMENTE
                             92 ;; REGISTERS DESTROYED: AF, AF', BC, DE, HL
                             93 ;; ENTRADA: IX -> Puntero a entidad
                             94 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   00B6                      95 cube_clearAll:
                             96 
                             97 ;;   ld  a, dc_col(ix)
                             98 ;;   ex af, af'
                             99 ;;
                            100 ;;   ld  dc_col(ix), #0
                            101 ;;
                            102 ;;   call render_drawCube
                            103 ;;   ex af, af'
                            104 ;;   ld dc_col(ix), a
                            105 
   00B6 C9            [10]  106    ret
                            107 
                            108 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                            109 ;;
                            110 ;;RESET CUBES TO FIRST STATE
                            111 ;;
                            112 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,
   00B7                     113 cube_reset:
                            114 
   00B7 CD 00 00      [17]  115 	call ball_reset
                            116 
   00BA 21 07 00      [10]  117 	ld hl, #cubeline10
   00BD 1E 00         [ 7]  118 	ld e, #0
   00BF 16 00         [ 7]  119 	ld d, #0
   00C1 0E 00         [ 7]  120 	ld c, #0
   00C3 DD 21 00 00   [14]  121 	ld ix, #cubedefault
   00C7                     122 	bucl:
                            123 
   00C7 7A            [ 4]  124 	ld a,d 
                            125 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 9.
Hexadecimal [16-Bits]



   00C8 77            [ 7]  126 	ld (hl),a
                            127 
   00C9 C6 04         [ 7]  128 	add #4
                            129 
   00CB 57            [ 4]  130 	ld d,a
   00CC 23            [ 6]  131 	inc hl
                            132 
                            133 
   00CD DD 7E 01      [19]  134 	ld a, dc_y(ix)
   00D0 77            [ 7]  135 	ld (hl),a
                            136 	
   00D1 23            [ 6]  137     inc hl
                            138 
   00D2 DD 7E 02      [19]  139     ld a, dc_w(ix)
   00D5 77            [ 7]  140 	ld (hl),a
                            141     
   00D6 23            [ 6]  142 	inc hl
                            143 
   00D7 DD 7E 03      [19]  144     ld a, dc_h(ix)
   00DA 77            [ 7]  145 	ld (hl),a
                            146     	
   00DB 23            [ 6]  147 	inc hl
                            148     	
   00DC DD 7E 04      [19]  149 	ld a, dc_sp_l(ix)
   00DF 77            [ 7]  150 	ld (hl),a
                            151 
   00E0 23            [ 6]  152 	inc hl
                            153 
   00E1 DD 7E 05      [19]  154 	ld a, dc_sp_h(ix)
   00E4 77            [ 7]  155 	ld (hl),a
                            156 
   00E5 23            [ 6]  157 	inc hl
                            158 
   00E6 DD 7E 06      [19]  159 	ld a, c_hp(ix)
   00E9 77            [ 7]  160 	ld (hl),a
                            161 ;;    ld a,c
                            162 ;;    sub #1
                            163 ;;
                            164 ;;    jp z, rojo
                            165 ;;
                            166 ;;    add #2
                            167 ;;    ld c,a
                            168 ;;	
                            169 ;;	ld a, #15
                            170 ;;
                            171 ;;    ld (hl),a
                            172 ;;
                            173 ;;    jp colorok
                            174 ;;    rojo:
                            175 ;;    ld c,a
                            176 ;;    
                            177 ;;    ld a, #255
                            178 ;;
                            179 ;;    ld (hl),a
                            180 ;;
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 10.
Hexadecimal [16-Bits]



                            181 ;;    jp colorok
                            182 ;;  	
                            183 ;;	colorok:
                            184 ;;
                            185 ;;    inc hl
                            186 ;;
                            187 ;;    	;;hp
                            188 ;;    inc hl
                            189 ;;
                            190 ;;  	ld a,e
                            191 ;;  	add #1
                            192 ;;
                            193 ;;  	ld e,a
                            194 
   00EA D6 0A         [ 7]  195   	sub #k_max_cube_line
                            196 
   00EC 20 D9         [12]  197     	jr nz, bucl
                            198 
                            199     	
                            200 
   00EE C9            [10]  201  ret
                            202 
   00EF                     203 destroy_cube:
   00EF 36 FF         [10]  204 	ld (hl),#0xFF
   00F1 23            [ 6]  205 	inc hl			;;	Y		
   00F2 23            [ 6]  206 	inc hl			;;	W
   00F3 23            [ 6]  207 	inc hl			;;	H
   00F4 23            [ 6]  208 	inc hl			;;	SP_L
   00F5 23            [ 6]  209 	inc hl			;;	SP_H
   00F6 23            [ 6]  210 	inc hl			;;  HP
                            211 
   00F7 36 00         [10]  212 	ld (hl),#0
                            213 
   00F9 2B            [ 6]  214 	dec hl			;; SP_H
   00FA 2B            [ 6]  215 	dec hl			;; SP_L
   00FB 2B            [ 6]  216 	dec hl			;; H 
   00FC 2B            [ 6]  217 	dec hl			;; W
   00FD 2B            [ 6]  218 	dec hl			;; Y
   00FE 2B            [ 6]  219 	dec hl			;; X
                            220 
   00FF 3A 4D 00      [13]  221 	ld a, (m_num_cube)
   0102 D6 01         [ 7]  222 	sub #1
   0104 32 4D 00      [13]  223 	ld (m_num_cube),a
                            224 
   0107 CA B7 00      [10]  225 	jp z, cube_reset
                            226 
   010A C9            [10]  227 ret
                            228 
